@model SkillBank.Site.Web.ViewModel.ProfilelModel
@using SkillBank.Site.Common
@{
    ViewBag.Title = "Personal";
    Layout = "~/Views/Shared/_MobileLayout.cshtml";
}
@Html.Partial("_MobileMenuPartial")

<!-- bug hack -->
<header class="bar-nav" data-ismember="@ViewBag.IsLogin"></header>

<div class="content personal-page" id="personal-page">
    <a class="icon icomoon icon-redo pull-right nav-inner nav-right nav-back"></a>
    <a href="index.html" class="icon icomoon icon-arrow-left nav-inner nav-left" data-transition="slide-out"></a>

    <div class="info">
        <h3>@Model.MemberInfo.Name</h3>
        <p><small>6km&nbsp;.&nbsp;上海</small></p>
        <img src="@ContentHelper.GetAvatarPath(Model.MemberInfo.Avatar, "mb", Model.MemberInfo.SocialType)" alt="" class="avatar">
        <p class="white"><small>@TextContentHelper.GetJoinUsDateText(Model.MemberInfo.CreatedDate)</small></p>
        <div class="btn-set mb-1">
            @if (ViewBag.MemberInfo == null)
            { 
                <a class="btn btn-default login-trigger">私信 TA</a>
            }
            else
            {
                <a href="#privateMsg" class="btn btn-default">私信 TA</a>
            }
            @if (ViewBag.MemberInfo != null && Model.MemberInfo.IsLike)
            {
                <a href="#" class="btn btn-olive follow followed" data-memberid="@Model.MemberInfo.MemberId">已关注</a>
            }
            else
            {
                <a href="#" class="btn btn-olive follow" data-memberid="@Model.MemberInfo.MemberId">关注</a>
            } 
        </div>
        <div class="nums">
            <table class="u-full-width">
                <thead>
                    <tr>
                        <th>@Model.ProfileNumDic[Enums.NumberDictionaryKey.Class]</th>
                        <th>@Model.ProfileNumDic[Enums.NumberDictionaryKey.Student]</th>
                        <th>@Model.ProfileNumDic[Enums.NumberDictionaryKey.Follow]</th>
                        <th class="fans-num">@Model.ProfileNumDic[Enums.NumberDictionaryKey.Fans]</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>教授</td>
                        <td>学习</td>
                        <td>关注</td>
                        <td>粉丝</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="content-padded">
        <p class="padded-tex">
            @Html.Raw(TextContentHelper.GetTextContent(Model.MemberInfo.SelfIntro))
        </p>
        @if (Model.ClassList != null)
        {
            <h4 align="center" class="mb-2">TA的分享课程（@Model.ClassList.Count）</h4>
        }
    </div>
    @if (Model.ClassList != null)
    {
        <div class="course-list" id="slider">
            <div class="course card">
                <div class="slider" id="mySlider">
                    <div class="slide-group">
                        @foreach (var classItem in Model.ClassList)
                        {
                            <div class="slide">
                                <div class="title-bar u-full-width">
                                    <a href="@Url.Action("course", "m", new { id = classItem.ClassId })" class="pull-left">@Html.Raw(TagHelper.GetTextSubSting(classItem.Title, 20, true))</a>
                                    <div class="pull-right">
                                        <!--<a href="#" class="icon icomoon icon-comment">
                                            <span class="num">14</span>
                                        </a>
                                        <a href="#" class="icon icomoon icon-heart">
                                            <span class="num">28</span>
                                        </a>-->
                                    </div>
                                </div>
                                <a href="@Url.Action("course", "m", new { id = classItem.ClassId })">
                                    <img src="@ContentHelper.GetClassCoverPath(classItem.Cover, "ms")"></a>
                            </div>
                        }
                    </div>
                </div>

            </div>
        </div>
                        if (Model.ClassList.Count > 1)
                        {
        <div id="bullets">
            <ul>
                @for (int i = 0; i < Model.ClassList.Count; i++)
                {
                    <li @(i == 0 ? "class=active" : "")></li>
                }
            </ul>
        </div>
                        }
    }



    <div id="comment">
        <div class="segmented-control">
            <a class="control-item active" href="#item1mobile">
                <h3>@Model.ProfileNumDic[Enums.NumberDictionaryKey.Certification]</h3>
                <h6>身份认证</h6>
            </a>
            <a class="control-item" @(Model.ProfileNumDic[Enums.NumberDictionaryKey.StudentReview] > 0 ? "href=#item2mobile" : "")>
                <h3>@Model.ProfileNumDic[Enums.NumberDictionaryKey.StudentReview]</h3>
                <h6>学生评价</h6>
            </a>
            <a class="control-item" @(Model.ProfileNumDic[Enums.NumberDictionaryKey.TeacherReview] > 0 ? "href=#item3mobile" : "")>
                <h3>@Model.ProfileNumDic[Enums.NumberDictionaryKey.TeacherReview]</h3>
                <h6>老师评价</h6>
            </a>
        </div>
        <div class="comment-content">
            <span id="item1mobile" class="control-content active">
                <ul class="comment-text verified">
                    <li class="card">
                        <h5>新浪微博</h5>
                        <small>weibo.com/@Model.MemberInfo.SocialAccount</small>
                        <img src="/img/icons/icon-correct.png"></li>
                    @if (Model.ProfileNumDic[Enums.NumberDictionaryKey.Certification] > 1)
                    {
                        <li class="table-view-cell">
                            <span>手机认证</span>
                            <small>@System.Text.RegularExpressions.Regex.Replace(Model.MemberInfo.Phone, @"(?im)(\d{3})(\d{6})(\d{2})", "$1******$3")</small>
                            <img src="/img/icons/icon-correct.png">
                        </li>
                    }
                </ul>
            </span>
            <span id="item2mobile" class="control-content">
                <ul class="comment-text">
                    @if (Model.StuentReview != null)
                    {
                        foreach (var reviewItem in Model.StuentReview)
                        {
                        <li class="card">
                            <div class="pull-left flag-num">
                                <a href="@Url.Action("personal", "m", new { id = reviewItem.MemberId })">
                                    <img class="avatar" src="@ContentHelper.GetAvatarPath(reviewItem.Avatar, "ms")">
                                </a>
                            </div>
                            <div class="msg-title">
                                <span class="time pull-right">@reviewItem.CreatedDate</span>
                                <h4 class="flag-num">@reviewItem.Name</h4>
                            </div>
                            <p>@reviewItem.Comment</p>
                        </li>
                        }
                    }
                </ul>
            </span>
            <span id="item3mobile" class="control-content">
                <ul class="comment-text">
                    @if (Model.TeacherReview != null)
                    {
                        foreach (var reviewItem in Model.TeacherReview)
                        {
                        <li class="card">
                            <div class="pull-left flag-num">
                                <a href="@Url.Action("personal", "m", new { id = reviewItem.MemberId })">
                                    <img class="avatar" src="@ContentHelper.GetAvatarPath(reviewItem.Avatar, "ms")">
                                </a>
                            </div>
                            <div class="msg-title">
                                <span class="time pull-right">@reviewItem.CreatedDate</span>
                                <h4 class="flag-num">@reviewItem.Name</h4>
                            </div>
                            <p>@reviewItem.Comment</p>
                        </li>
                        }
                    }
                </ul>
            </span>
        </div>
    </div>

    <div id="privateMsg" class="modal toBeRemoved">
        <header class="bar bar-nav">
            <a class="icon icon-close pull-right grey" href="#privateMsg"></a>
            <h1 class="title">私信老师</h1>
        </header>

        <div class="content">
            <div class="content-inner">
                <div class="content-padded">
                    <form>
                        <textarea name="" id="" cols="30" rows="6" placeholder="输入你的私信内容，向老师咨询关于课程的各种问题"></textarea>
                        <button class="btn btn-primary btn-block">发送私信</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

</div>
<script src="/bower_components/jquery/dist/jquery.min.js"></script>
<script src="/bower_components/lodash/dist/lodash.min.js"></script>
