using System;
using System.Data;
using System.Collections.Generic;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using System.Net.Mail;
using Assert = NUnit.Framework.Assert;

using SkillBank.Site.Services;
using SkillBank.Site.Common;
using SkillBank.Site.Services.Net.Mail;

namespace SkillBank.FunctionTests
{
    [TestClass]
    public class EmailManagerTests
    {
        [TestMethod]
        public void ShouldSendEmail()
        {
            //Dictionary<String, String> messageParams = null;
            String messageBody = string.Format(@"<!DOCTYPE html PUBLIC ""-//W3C//DTD XHTML 1.0 Transitional//EN"" ""http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd""><html><head></head><body><table><tr><td><img src=""{0}""/></td></tr><tr><td style=""height:200px"">" + "访问我们的官方网站6" + @"</td></tr><tr><td><a href=""{1}"">{2}</a></td></tr></table></body></html>", "http://www.skillbank.cn/img/logo-30.png", "http://www.skillbank.cn", "技能银行");
            //String messageBody = string.Format(@"<!DOCTYPE HTML PUBLIC ""-//W3C//DTD XHTML 1.0 Transitional //EN"" ""http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd""><html><head><title></title><meta http-equiv=""Content-Type"" content=""text/html; charset=gb2312""><meta name="viewport" content="width=320, target-densitydpi=device-dpi"><style type="text/css">                @media only screen and (max-width: 660px) {            table[class=w0], td[class=w0] {                width: 0 !important;            }            table[class=w10], td[class=w10], img[class=w10] {                width: 10px !important;            }            table[class=w15], td[class=w15], img[class=w15] {                width: 5px !important;            }            table[class=w30], td[class=w30], img[class=w30] {                width: 10px !important;            }            table[class=w60], td[class=w60], img[class=w60] {                width: 10px !important;            }            table[class=w125], td[class=w125], img[class=w125] {                width: 80px !important;            }            table[class=w130], td[class=w130], img[class=w130] {                width: 55px !important;            }            table[class=w140], td[class=w140], img[class=w140] {                width: 90px !important;            }            table[class=w160], td[class=w160], img[class=w160] {                width: 180px !important;            }            table[class=w170], td[class=w170], img[class=w170] {                width: 100px !important;            }            table[class=w180], td[class=w180], img[class=w180] {                width: 80px !important;            }            table[class=w195], td[class=w195], img[class=w195] {                width: 80px !important;            }            table[class=w220], td[class=w220], img[class=w220] {                width: 80px !important;            }            table[class=w240], td[class=w240], img[class=w240] {                width: 180px !important;            }            table[class=w255], td[class=w255], img[class=w255] {                width: 185px !important;            }            table[class=w275], td[class=w275], img[class=w275] {                width: 135px !important;            }            table[class=w280], td[class=w280], img[class=w280] {                width: 135px !important;            }            table[class=w300], td[class=w300], img[class=w300] {                width: 140px !important;            }            table[class=w325], td[class=w325], img[class=w325] {                width: 95px !important;            }            table[class=w360], td[class=w360], img[class=w360] {                width: 140px !important;            }            table[class=w410], td[class=w410], img[class=w410] {                width: 180px !important;            }            table[class=w470], td[class=w470], img[class=w470] {                width: 200px !important;            }            table[class=w580], td[class=w580], img[class=w580] {                width: 280px !important;            }            table[class=w640], td[class=w640], img[class=w640] {                width: 300px !important;            }            table[class*=hide], td[class*=hide], img[class*=hide], p[class*=hide], span[class*=hide] {                display: none !important;            }            table[class=h0], td[class=h0] {                height: 0 !important;            }            p[class=footer-content-left] {                text-align: left !important;            }            p[class=footer-content-right] {                text-align: right !important;            }            #headline p {                font-size: 30px !important;            }            .article-content, #left-sidebar {                -webkit-text-size-adjust: 90% !important;                -ms-text-size-adjust: 90% !important;            }            .header-content, .footer-content-left {                -webkit-text-size-adjust: 80% !important;                -ms-text-size-adjust: 80% !important;            }            img {                height: auto;                line-height: 100%;            }        }                #outlook a {            padding: 0;        }                body {            width: 100% !important;        }        .ReadMsgBody {            width: 100%;        }        .ExternalClass {            width: 100%;            display: block !important;        }        body {            background-color: #ffffff;            margin: 0;            padding: 0;        }        img {            outline: none;            text-decoration: none;            display: block;        }        br, strong br, b br, em br, i br {            line-height: 100%;        }        h1, h2, h3, h4, h5, h6 {            line-height: 100% !important;            -webkit-font-smoothing: antialiased;        }            h1 a, h2 a, h3 a, h4 a, h5 a, h6 a {                color: blue !important;            }                h1 a:active, h2 a:active, h3 a:active, h4 a:active, h5 a:active, h6 a:active {                    color: red !important;                }                                h1 a:visited, h2 a:visited, h3 a:visited, h4 a:visited, h5 a:visited, h6 a:visited {                    color: purple !important;                }                table td, table tr {            border-collapse: collapse;        }        .yshortcuts, .yshortcuts a, .yshortcuts a:link, .yshortcuts a:visited, .yshortcuts a:hover, .yshortcuts a span {            color: black;            text-decoration: none !important;            border-bottom: none !important;            background: none !important;        }        code {            white-space: normal;            word-break: break-all;        }        #background-table {            background-color: #ffffff;        }                #top-bar {            border-radius: 6px 6px 0px 0px;            -moz-border-radius: 6px 6px 0px 0px;            -webkit-border-radius: 6px 6px 0px 0px;            -webkit-font-smoothing: antialiased;            background-color: #043948;            color: #e7cba3;        }            #top-bar a {                font-weight: bold;                color: #e7cba3;                text-decoration: none;            }        #footer {            border-radius: 0px 0px 6px 6px;            -moz-border-radius: 0px 0px 6px 6px;            -webkit-border-radius: 0px 0px 6px 6px;            -webkit-font-smoothing: antialiased;        }                body, td {            font-family: HelveticaNeue, sans-serif;        }        .header-content, .footer-content-left, .footer-content-right {            -webkit-text-size-adjust: none;            -ms-text-size-adjust: none;        }                .header-content {            font-size: 12px;            color: #e7cba3;        }            .header-content a {                font-weight: bold;                color: #e7cba3;                text-decoration: none;            }        #headline p {            color: #e7cba3;            font-family: HelveticaNeue, sans-serif;            font-size: 36px;            text-align: center;            margin-top: 0px;            margin-bottom: 30px;        }            #headline p a {                color: #e7cba3;                text-decoration: none;            }        .article-title {            font-size: 18px;            line-height: 24px;            color: #ffffff;            font-weight: bold;            margin-top: 0px;            margin-bottom: 18px;            font-family: HelveticaNeue, sans-serif;        }            .article-title a {                color: #ffffff;                text-decoration: none;            }            .article-title.with-meta {                margin-bottom: 0;            }        .article-meta {            font-size: 13px;            line-height: 20px;            color: #ccc;            font-weight: bold;            margin-top: 0;        }        .article-content {            font-size: 13px;            line-height: 18px;            color: #ffffff;            margin-top: 0px;            margin-bottom: 18px;            font-family: HelveticaNeue, sans-serif;        }            .article-content a {                color: #ffd048;                font-weight: bold;                text-decoration: none;            }            .article-content img {                max-width: 100%;            }            .article-content ol, .article-content ul {                margin-top: 0px;                margin-bottom: 18px;                margin-left: 19px;                padding: 0;            }            .article-content li {                font-size: 13px;                line-height: 18px;                color: #ffffff;            }                .article-content li a {                    color: #ffd048;                    text-decoration: underline;                }            .article-content p {                margin-bottom: 15px;            }        .footer-content-left {            font-size: 12px;            line-height: 10px;            color: #e2e2e2;            margin-top: 0px;            margin-bottom: 15px;        }            .footer-content-left a {                color: #e7cba3;                font-weight: bold;                text-decoration: none;            }        .footer-content-right {            font-size: 11px;            line-height: 10px;            color: #e2e2e2;            margin-top: 0px;            margin-bottom: 15px;        }            .footer-content-right a {                color: #e7cba3;                font-weight: bold;                text-decoration: none;            }        #footer {            background-color: #043948;            color: #e2e2e2;        }            #footer a {                color: #e7cba3;                text-decoration: none;                font-weight: bold;            }        #permission-reminder {            white-space: normal;        }        #street-address {            color: #e7cba3;            white-space: normal;        }        .article-content1 {            -webkit-text-size-adjust: 90% !important;            -ms-text-size-adjust: 90% !important;        }        .article-content1 {            font-size: 13px;            line-height: 18px;            color: #ffffff;            margin-top: 0px;            margin-bottom: 18px;            font-family: HelveticaNeue, sans-serif;        }</style></head><body><table width="100%" cellpadding="0" cellspacing="0" border="0" id="background-table" style="table-layout: fixed" align="center"><tbody><tr><td align="center" bgcolor="#ffffff"><table class="w640" style="margin: 0 10px;" width="640" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td class="w640" width="640" height="20"></td></tr><tr><td class="w640" width="640"><table id="top-bar" class="w640" width="640" cellpadding="0" cellspacing="0" border="0" bgcolor="#043948"><tbody><tr><td class="w15" width="15"></td><td class="w325" width="350" valign="middle" align="left"><table class="w325" width="350" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td class="w325" width="350" height="8"></td></tr></tbody></table><table class="w325" width="350" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td class="w325" width="350" height="8"></td></tr></tbody></table></td><td class="w30" width="30"></td><td class="w255" width="255" valign="middle" align="right"><table class="w255" width="255" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td class="w255" width="255" height="8"></td></tr></tbody></table><table cellpadding="0" cellspacing="0" border="0"><tbody><tr></tr></tbody></table><table class="w255" width="255" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td class="w255" width="255" height="8"></td></tr></tbody></table></td><td class="w15" width="15"></td></tr></tbody></table></td></tr><tr><td id="header" class="w640" width="640" align="center" bgcolor="#043948"><div align="center" style="text-align: center"><a href="http://www.skillbank.cn"><img id="customHeaderImage" label="Header Image" editable="true" width="640" src="./images/header.png" class="w640" border="0" align="top" style="display: inline" /></a></div></td></tr><tr><td class="w640" width="640" height="30" bgcolor="#043948"></td></tr><tr id="simple-content-row"><td class="w640" width="640" bgcolor="#043948"><table align="left" class="w640" width="640" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td class="w30" width="30"></td><td class="w580" width="580"><repeater><layout label="Text only"><table class="w580" width="580" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td class="w580" width="580"><p align="left" class="article-title" style="color:#79bcc9;"><singleline label="Title">欢迎加入技能银行，开始你的分享之旅</singleline></p></td></tr></tbody></table></layout><layout label="Text with full-width image"><table class="w580" width="580" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td class="w580" width="580"><p align="left"><div align="left" class="article-content"><multiline label="Description"><p style="font-size:14px; font-weight:bold">尊敬的{用户名}：</p><p style="line-height:20px;"><strong>您好，恭喜您已经成为技能银行注册用户。技能银行是一个能让您分享和学习知识技能的交换平台，我们坚信“每个人都有一技之长”，您现在就可以来<a href="http://www.skillbank.cn/class/beteacher?etag=welcomeEmail1" target="_blank">“分享你的技能”</a>，开课获取免费课币后就可以去尝试您想要学习的知识技能了！祝您在技能平台获得有趣且愉悦的技能交换之旅。</p></multiline></div></p></td></tr><tr><td class="w580" width="580"></td></tr><tr><td class="w580" width="580"><div align="left" class="article-content"><multiline label="Description"><p>想了解更多关于技能银行，<strong><a href="http://www.skillbank.cn/aboutus?etag=welcomeEmail2" target="_blank">请点击这里</a></strong><br /></p><p>                                          如果您有任何疑问，<a href="mailto:contact@skill-bank.com">请随时联系我们</a></p></multiline></div></td></tr><tr><td class="w580" width="580" height="10"></td></tr></tbody></table></layout><layout label="Text with right-aligned image"></layout><layout label="Text with left-aligned image"></layout><layout label="Two columns"></layout><layout label="Image gallery"></layout></repeater></td><td class="w30" width="30"></td></tr></tbody></table></td></tr><tr><td class="w640" width="640" height="15" bgcolor="#043948"></td></tr><tr><td class="w640" width="640"><table id="footer" class="w640" width="640" cellpadding="0" cellspacing="0" border="0" bgcolor="#043948"><tbody><tr><td class="w30" width="10"></td><td width="135" height="10" class="w580 h0"></td><td class="w0" width="155"></td></tr><tr><td class="w30" width="10"></td><td class="w280" valign="bottom"><p align="left"><preferences lang="zh-CHS"></preferences></p></td><td class="w180" width="155" align="right"><table width="180" border="0" cellspacing="0" cellpadding="0"><tr><td style="font-size: 12px; color: #FFF;"><strong>关注我们</strong></td><td><a href="http://weibo.com/SkllBank" target="_blank"><img src="images/icon_weibo.png" width="23" height="23" alt="新浪微博" /></a></td><td><a href="http://page.renren.com/601881751" target="_blank"><img src="images/icon_renren.png" width="23" height="23" alt="人人网" /></a></td><td><a href="http://site.douban.com/242373/" target="_blank"><img src="images/icon_douban.png" width="23" height="23" alt="豆瓣" /></a></td><td><a href="http://t.qq.com/skill-bank" target="_blank"><img src="images/icon_tencent.png" width="23" height="23" alt="腾讯微博" /></a></td></tr></table></td></tr><tr><td class="w30" width="10"></td><td class="w580 h0" height="10"></td><td class="w0" width="155"></td></tr></tbody></table></td></tr><tr><td class="w640" width="640" height="43"></td></tr></tbody></table></td></tr></tbody></table></body></html>"
            //MailMessage message = new MailMessage(ConfigConstants.MailSetting.FromAddress, ConfigConstants.MailSetting.ToAddress4Testing1, ConfigConstants.MailContent.WelcomeEmailSubject, messageBody);
            //message.Body = messageBody;
            //message.BodyEncoding= System.Text.UTF8Encoding.Unicode;
            MailMessage message = new MailMessage(ConfigConstants.MailSetting.FromAddress, ConfigConstants.MailSetting.ToAddress4Testing2, ConfigConstants.SendCloudMailSetting.Welcome_EmailSubject, messageBody);
            EmailManager.SendMessage(message);

            message = new MailMessage(ConfigConstants.MailSetting.FromAddress, ConfigConstants.MailSetting.ToAddress4Testing1, ConfigConstants.SendCloudMailSetting.Welcome_EmailSubject, messageBody);
            EmailManager.SendMessage(message);
            message = new MailMessage(ConfigConstants.MailSetting.FromAddress, ConfigConstants.MailSetting.ToAddress4Testing3, ConfigConstants.SendCloudMailSetting.Welcome_EmailSubject, messageBody);
            EmailManager.SendMessage(message);
            message = new MailMessage(ConfigConstants.MailSetting.FromAddress, ConfigConstants.MailSetting.ToAddress4Testing4, ConfigConstants.SendCloudMailSetting.Welcome_EmailSubject, messageBody);
            EmailManager.SendMessage(message);
            message = new MailMessage(ConfigConstants.MailSetting.FromAddress, ConfigConstants.MailSetting.ToAddress4Testing5, ConfigConstants.SendCloudMailSetting.Welcome_EmailSubject, messageBody);
            EmailManager.SendMessage(message);
        }

        [TestMethod]
        public void ShouldSendEmailByTemplate()
        {
            String messageBody = "testbody mail ";
            MailMessage message = new MailMessage(ConfigConstants.MailSetting.FromAddress, ConfigConstants.MailSetting.ToAddress4Testing1, ConfigConstants.SendCloudMailSetting.Welcome_EmailSubject, messageBody);
            Dictionary<String, String> templateParams = new Dictionary<string, string>();
            templateParams.Add("MemberName", "Cathy");
            EmailManager.SendMessage(ConfigConstants.MailSetting.ToAddress4Testing1, "Cathy", ConfigConstants.MailSetting.FromAddress, "Skill Bank", "cs", "", "Test Email subject", ConfigConstants.SendCloudMailSetting.Welcome_EmailSubject, templateParams);
        }

        [TestMethod]
        public void ShouldSendEmailBySendCloud()
        {
            SendCloudEmail.SendWelcomeMail("cathy_mu@126.com", "凯西");
        }

        [TestMethod]
        public void ShouldSendClassProvedMailBySendCloud()
        {
            SendCloudEmail.SendClassProvedMail("cathy_mu@126.com", "凯西", "游泳基础知识");
            //SendCloudEmail.SendClassProvedMail("elaine11@163.com", "周妮妮", "英语口语课");
        }

        [TestMethod]
        public void ShouldSendClassRejectMailBySendCloud()
        {
            SendCloudEmail.SendClassRejectMail("cathy_mu@yeah.net", "凯西", "游泳基础知识");
            //SendCloudEmail.SendClassRejectMail("elaine11@163.com", "周妮妮3", "讲价课");
        }

        [TestMethod]
        public void ShouldSendMessageReceiveMail()
        {
            SendCloudEmail.SendMessageReceiveMail("cathy.mu@qq.com", "凯西", "周妮妮", "http://www.skillbank.cn/chat/6");
            //SendCloudEmail.SendMessageReceiveMail("elaine11@163.com", "周妮妮", "凯西", "http://www.skillbank.cn/chat/1");
        }

        [TestMethod]
        public void ShouldSendClassListMailBySendCloud()
        {
            //SendCloudEmail.SendTemplateMailByMailList();
        }


        //[TestMethod]
        //public void ShouldSendOrderStatusUpateMail()
        //{
        //    String mailText = 	"您好，有学生预订了您的《鼓手基本节奏》";
        //    SendCloudEmail.SendOrderStatusUpdateMail("contact@skill-bank.com", "州州",mailText, Constants.PageURL.MemberTeachPage);
        //}

    }
}
